/**
 * Demo data: Vulnerability Remediation â€” Oracle VirtualBox CVEs
 */
import { PlaybookGraph, PlaybookLibraryItem } from '../types';

export const markdown = `# Vulnerability Remediation Playbook: Oracle VirtualBox CVEs
**Type:** Software Patch Management / Virtualization Infrastructure
**Tooling:** Wazuh (detection) + Chocolatey/Oracle Installer (remediation)
**Difficulty:** Beginner
**Estimated Time:** 15-30 minutes
**Last Updated:** 2026-02-02

---

## Overview
Remediate Oracle VirtualBox CVEs detected by Wazuh vulnerability scanner. VirtualBox 7.2.4 had 14 disclosed vulnerabilities (11 High, 3 Medium severity) patched in version 7.2.6.

## Detection (Wazuh)

### Alert Signature
- **Rule Group:** vulnerability-detector
- **package.name:** Oracle VirtualBox 7.2.4
- **severity:** High (11), Medium (3)

### Dashboard Query
\`\`\`sql
vulnerability.severity: (High OR Medium)
package.name: "Oracle VirtualBox*"
\`\`\`

### Initial Triage Questions
1. Are there active VMs on this host?
2. Is this VirtualBox instance actively used?
3. What is the latest patched version?

## Investigation

### Step 1: Verify Current Version
\`\`\`powershell
Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* |
    Where-Object {\$_.DisplayName -like "*VirtualBox*"} |
    Select DisplayName, DisplayVersion
\`\`\`

### Step 2: Check for Active VMs
\`\`\`powershell
& "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe" list vms
& "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe" list runningvms
\`\`\`

### Step 3: Document VM State
\`\`\`powershell
& "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe" list vms > C:\\temp\\virtualbox-vms-pre-update.txt
\`\`\`

## Remediation

### Option A: Update via Chocolatey (Recommended)
\`\`\`powershell
choco upgrade virtualbox -y
& "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe" --version
\`\`\`

### Option B: Manual Download and Install
\`\`\`powershell
Invoke-WebRequest -Uri "https://download.virtualbox.org/virtualbox/7.2.6/VirtualBox-7.2.6-Win.exe" -OutFile "\$env:TEMP\\VirtualBox-7.2.6.exe"
& "\$env:TEMP\\VirtualBox-7.2.6.exe" --silent
\`\`\`

### Option C: Remove VirtualBox (If Unused)
\`\`\`powershell
choco uninstall virtualbox -y
\`\`\`

## Verification

### Immediate Check
\`\`\`powershell
& "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe" --version
& "C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage.exe" list vms
\`\`\`

### Wazuh Confirmation
\`\`\`powershell
Restart-Service -Name "Wazuh"
\`\`\`

## Post-Remediation
1. Record VirtualBox version update (7.2.4 to 7.2.6)
2. Verify all VMs functional post-update
3. Update asset inventory with new version
4. Save CSV report as evidence
`;

export const graph: PlaybookGraph = {
  nodes: [
    { id: 'node_0', label: 'Vulnerability Remediation Playbook: Oracle VirtualBox CVEs', type: 'phase', metadata: { level: 1, header_type: 'h1' } },
    { id: 'node_1', label: 'Overview', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_2', label: 'Detection (Wazuh)', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_3', label: 'Alert Signature', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_4', label: 'Dashboard Query', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_5', label: 'Execute sql', type: 'execute', metadata: { language: 'sql' } },
    { id: 'node_6', label: 'Initial Triage Questions', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_7', label: 'Are there active VMs on this host?', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_8', label: 'Is this VirtualBox instance actively used?', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_9', label: 'What is the latest patched version?', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_10', label: 'Investigation', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_11', label: 'Step 1: Verify Current Version', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_12', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_13', label: 'Step 2: Check for Active VMs', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_14', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_15', label: 'Step 3: Document VM State', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_16', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_17', label: 'Remediation', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_18', label: 'Option A: Update via Chocolatey (Recommended)', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_19', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_20', label: 'Option B: Manual Download and Install', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_21', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_22', label: 'Option C: Remove VirtualBox (If Unused)', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_23', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_24', label: 'Verification', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_25', label: 'Immediate Check', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_26', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_27', label: 'Wazuh Confirmation', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_28', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell' } },
    { id: 'node_29', label: 'Post-Remediation', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_30', label: 'Record VirtualBox version update (7.2.4 to 7.2.6)', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_31', label: 'Verify all VMs functional post-update', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_32', label: 'Update asset inventory with new version', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_33', label: 'Save CSV report as evidence', type: 'step', metadata: { step_type: 'sequential' } },
  ],
  edges: [
    { id: 'edge_0', source: 'node_0', target: 'node_1' },
    { id: 'edge_1', source: 'node_1', target: 'node_2' },
    { id: 'edge_2', source: 'node_2', target: 'node_3' },
    { id: 'edge_3', source: 'node_3', target: 'node_4' },
    { id: 'edge_4', source: 'node_4', target: 'node_5' },
    { id: 'edge_5', source: 'node_5', target: 'node_6' },
    { id: 'edge_6', source: 'node_6', target: 'node_7' },
    { id: 'edge_7', source: 'node_7', target: 'node_8' },
    { id: 'edge_8', source: 'node_8', target: 'node_9' },
    { id: 'edge_9', source: 'node_9', target: 'node_10' },
    { id: 'edge_10', source: 'node_10', target: 'node_11' },
    { id: 'edge_11', source: 'node_11', target: 'node_12' },
    { id: 'edge_12', source: 'node_12', target: 'node_13' },
    { id: 'edge_13', source: 'node_13', target: 'node_14' },
    { id: 'edge_14', source: 'node_14', target: 'node_15' },
    { id: 'edge_15', source: 'node_15', target: 'node_16' },
    { id: 'edge_16', source: 'node_16', target: 'node_17' },
    { id: 'edge_17', source: 'node_17', target: 'node_18' },
    { id: 'edge_18', source: 'node_18', target: 'node_19' },
    { id: 'edge_19', source: 'node_19', target: 'node_20' },
    { id: 'edge_20', source: 'node_20', target: 'node_21' },
    { id: 'edge_21', source: 'node_21', target: 'node_22' },
    { id: 'edge_22', source: 'node_22', target: 'node_23' },
    { id: 'edge_23', source: 'node_23', target: 'node_24' },
    { id: 'edge_24', source: 'node_24', target: 'node_25' },
    { id: 'edge_25', source: 'node_25', target: 'node_26' },
    { id: 'edge_26', source: 'node_26', target: 'node_27' },
    { id: 'edge_27', source: 'node_27', target: 'node_28' },
    { id: 'edge_28', source: 'node_28', target: 'node_29' },
    { id: 'edge_29', source: 'node_29', target: 'node_30' },
    { id: 'edge_30', source: 'node_30', target: 'node_31' },
    { id: 'edge_31', source: 'node_31', target: 'node_32' },
    { id: 'edge_32', source: 'node_32', target: 'node_33' },
  ],
};

export const libraryItem: PlaybookLibraryItem = {
  slug: 'vulnerability-remediation-virtualbox',
  metadata: {
    title: 'Vulnerability Remediation Playbook: Oracle VirtualBox CVEs',
    type: 'Software Patch Management / Virtualization Infrastructure',
    tooling: 'Wazuh (detection) + Chocolatey/Oracle Installer (remediation)',
    difficulty: 'Beginner',
    estimatedTime: '15-30 minutes',
    lastUpdated: '2026-02-02',
  },
  category: 'vulnerability-remediation',
  markdown,
  graph,
  description:
    'Remediate Oracle VirtualBox CVEs detected by Wazuh vulnerability scanner. 14 vulnerabilities (11 High, 3 Medium) patched by upgrading from 7.2.4 to 7.2.6.',
  tags: ['virtualbox', 'oracle', 'cve', 'wazuh', 'chocolatey', 'hypervisor'],
};
