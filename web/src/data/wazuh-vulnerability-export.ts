/**
 * Demo data: Wazuh Before/After Vulnerability Export
 */
import { PlaybookGraph, PlaybookLibraryItem } from '../types';

export const markdown = `# Wazuh SOC Playbook: Before/After Vulnerability Export
**Type:** SIEM Operations / Evidence Collection
**Tooling:** Wazuh Dashboard + Saved Searches + CSV Export
**Last Updated:** 2026-02-05

---

## Overview
Export vulnerability data from Wazuh for a specific agent/machine to create before and after evidence for remediation documentation.

## How It Works
Wazuh stores vulnerability data in the wazuh-states-vulnerabilities-* index. We create a saved search filtered by agent ID, then export it as CSV via the Reporting feature.

## Step-by-Step Process

### Step 1: Navigate to Discover
1. Open Wazuh Dashboard
2. Click Menu > Explore > Discover

### Step 2: Select Vulnerability Index
1. Click the index pattern dropdown
2. Select wazuh-states-vulnerabilities-*

### Step 3: Filter by Agent
1. In the Search bar, type: agent.id: 031
2. Press Enter to apply the filter
3. Verify the hit count matches expected vulnerabilities

### Step 4: Save the Search (Template)
1. Click Save (top right)
2. Enter a descriptive name
3. Click Save

### Step 5: Export CSV
1. Click Reporting (top right)
2. Click Generate CSV
3. Wait for generation (may take 1-2 minutes)
4. Navigate to Dashboard Management > Reporting
5. Find your report and click CSV to download

### Step 6: Capture Screenshots
1. Navigate to Threat Intelligence > Vulnerability Detection
2. Pin your agent
3. Screenshot the severity counts

## Complete Before/After Workflow
\`\`\`
BEFORE REMEDIATION
  1. Run saved search for target agent
  2. Export CSV -> save as "BEFORE_[date].csv"
  3. Screenshot dashboard (severity counts)
  4. Document counts: Critical, High, Medium, Low

REMEDIATION
  - Apply Windows Updates
  - Update software packages
  - Apply security patches

AFTER REMEDIATION
  1. Wait for Wazuh vulnerability scan
  2. Run same saved search
  3. Export CSV -> save as "AFTER_[date].csv"
  4. Screenshot dashboard (new severity counts)
  5. Compare CSVs to identify remediated CVEs
\`\`\`

## Quick Reference Commands

### Trigger Vulnerability Scan on Agent (Linux)
\`\`\`bash
sudo systemctl restart wazuh-agent
\`\`\`

### Trigger Vulnerability Scan on Agent (Windows)
\`\`\`powershell
Restart-Service WazuhSvc
\`\`\`

### Wazuh API: Get Agent Vulnerabilities
\`\`\`bash
GET /vulnerability/{agent_id}?limit=1000
\`\`\`
`;

export const graph: PlaybookGraph = {
  nodes: [
    { id: 'node_0', label: 'Wazuh SOC Playbook: Before/After Vulnerability Export', type: 'phase', metadata: { level: 1, header_type: 'h1' } },
    { id: 'node_1', label: 'Overview', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_2', label: 'How It Works', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_3', label: 'Step-by-Step Process', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_4', label: 'Step 1: Navigate to Discover', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_5', label: 'Open Wazuh Dashboard', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_6', label: 'Click Menu > Explore > Discover', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_7', label: 'Step 2: Select Vulnerability Index', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_8', label: 'Click the index pattern dropdown', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_9', label: 'Select wazuh-states-vulnerabilities-*', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_10', label: 'Step 3: Filter by Agent', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_11', label: 'In the Search bar, type: agent.id: 031', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_12', label: 'Press Enter to apply the filter', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_13', label: 'Verify the hit count matches expected vulnerabilities', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_14', label: 'Step 4: Save the Search (Template)', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_15', label: 'Click Save (top right)', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_16', label: 'Enter a descriptive name', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_17', label: 'Click Save', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_18', label: 'Step 5: Export CSV', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_19', label: 'Click Reporting (top right)', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_20', label: 'Click Generate CSV', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_21', label: 'Wait for generation (may take 1-2 minutes)', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_22', label: 'Navigate to Dashboard Management > Reporting', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_23', label: 'Find your report and click CSV to download', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_24', label: 'Step 6: Capture Screenshots', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_25', label: 'Navigate to Threat Intelligence > Vulnerability Detection', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_26', label: 'Pin your agent', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_27', label: 'Screenshot the severity counts', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_28', label: 'Complete Before/After Workflow', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_29', label: 'Execute code', type: 'execute', metadata: { language: '' } },
    { id: 'node_30', label: 'Quick Reference Commands', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_31', label: 'Trigger Vulnerability Scan on Agent (Linux)', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_32', label: 'Execute bash', type: 'execute', metadata: { language: 'bash', code: 'sudo systemctl restart wazuh-agent' } },
    { id: 'node_33', label: 'Trigger Vulnerability Scan on Agent (Windows)', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_34', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'Restart-Service WazuhSvc' } },
    { id: 'node_35', label: 'Wazuh API: Get Agent Vulnerabilities', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_36', label: 'Execute bash', type: 'execute', metadata: { language: 'bash', code: 'GET /vulnerability/{agent_id}?limit=1000' } },
  ],
  edges: [
    { id: 'edge_0', source: 'node_0', target: 'node_1' },
    { id: 'edge_1', source: 'node_1', target: 'node_2' },
    { id: 'edge_2', source: 'node_2', target: 'node_3' },
    { id: 'edge_3', source: 'node_3', target: 'node_4' },
    { id: 'edge_4', source: 'node_4', target: 'node_5' },
    { id: 'edge_5', source: 'node_5', target: 'node_6' },
    { id: 'edge_6', source: 'node_6', target: 'node_7' },
    { id: 'edge_7', source: 'node_7', target: 'node_8' },
    { id: 'edge_8', source: 'node_8', target: 'node_9' },
    { id: 'edge_9', source: 'node_9', target: 'node_10' },
    { id: 'edge_10', source: 'node_10', target: 'node_11' },
    { id: 'edge_11', source: 'node_11', target: 'node_12' },
    { id: 'edge_12', source: 'node_12', target: 'node_13' },
    { id: 'edge_13', source: 'node_13', target: 'node_14' },
    { id: 'edge_14', source: 'node_14', target: 'node_15' },
    { id: 'edge_15', source: 'node_15', target: 'node_16' },
    { id: 'edge_16', source: 'node_16', target: 'node_17' },
    { id: 'edge_17', source: 'node_17', target: 'node_18' },
    { id: 'edge_18', source: 'node_18', target: 'node_19' },
    { id: 'edge_19', source: 'node_19', target: 'node_20' },
    { id: 'edge_20', source: 'node_20', target: 'node_21' },
    { id: 'edge_21', source: 'node_21', target: 'node_22' },
    { id: 'edge_22', source: 'node_22', target: 'node_23' },
    { id: 'edge_23', source: 'node_23', target: 'node_24' },
    { id: 'edge_24', source: 'node_24', target: 'node_25' },
    { id: 'edge_25', source: 'node_25', target: 'node_26' },
    { id: 'edge_26', source: 'node_26', target: 'node_27' },
    { id: 'edge_27', source: 'node_27', target: 'node_28' },
    { id: 'edge_28', source: 'node_28', target: 'node_29' },
    { id: 'edge_29', source: 'node_29', target: 'node_30' },
    { id: 'edge_30', source: 'node_30', target: 'node_31' },
    { id: 'edge_31', source: 'node_31', target: 'node_32' },
    { id: 'edge_32', source: 'node_32', target: 'node_33' },
    { id: 'edge_33', source: 'node_33', target: 'node_34' },
    { id: 'edge_34', source: 'node_34', target: 'node_35' },
    { id: 'edge_35', source: 'node_35', target: 'node_36' },
  ],
};

export const libraryItem: PlaybookLibraryItem = {
  slug: 'wazuh-vulnerability-export',
  metadata: {
    title: 'Wazuh SOC Playbook: Before/After Vulnerability Export',
    type: 'SIEM Operations / Evidence Collection',
    tooling: 'Wazuh Dashboard + Saved Searches + CSV Export',
    lastUpdated: '2026-02-05',
  },
  category: 'siem-operations',
  markdown,
  graph,
  description:
    'Export vulnerability data from Wazuh for a specific agent/machine to create before and after evidence for remediation documentation.',
  tags: ['wazuh', 'siem', 'csv-export', 'evidence', 'vulnerability-management'],
};
