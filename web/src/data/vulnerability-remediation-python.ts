/**
 * Demo data: Vulnerability Remediation â€” Python CVEs
 */
import { PlaybookGraph, PlaybookLibraryItem } from '../types';

export const markdown = `# Vulnerability Remediation Playbook: Python CVEs
**Type:** Software Patch Management / Python Environment Hygiene
**Tooling:** Wazuh (detection) + Chocolatey/Package Manager (remediation)
**Last Updated:** 2026-02-02

---

## Overview
Remediate Python-related CVEs detected by Wazuh vulnerability scanner. Addresses multiple Python installations and version sprawl.

## Detection (Wazuh)

### Alert Signature
- **Rule Group:** vulnerability-detector
- **package.name:** Python or Python 3.x
- **severity:** Critical / High

### Dashboard Query
\`\`\`sql
vulnerability.severity: Critical
package.name: Python
\`\`\`

## Investigation

### Step 1: Inventory Python Installations
\`\`\`powershell
Get-Command python* -ErrorAction SilentlyContinue | Format-Table -AutoSize
\`\`\`

### Step 2: Identify Vulnerable Versions
Cross-reference installed versions with CVE database:
- If version < 3.10.16 then flag as vulnerable
- If version >= 3.14.0 then mark as patched

### Step 3: Check Active Usage
\`\`\`powershell
Get-Process | Where-Object {\$_.Path -match "Python310|Python311"}
\`\`\`

### Step 4: Determine Dependencies
\`\`\`powershell
& "C:\\Python310\\python.exe" -m pip list
\`\`\`

## Remediation Options

### Option A: Uninstall Outdated Versions (Recommended if unused)
\`\`\`powershell
& "\$env:LOCALAPPDATA\\Package Cache\\{GUID}\\python-3.10.11-amd64.exe" /uninstall /quiet
\`\`\`

### Option B: Update to Patched Versions
\`\`\`powershell
choco upgrade python310 python311 -y
\`\`\`

### Option C: Standardize on One Source
\`\`\`powershell
choco install python --version=3.14.2 -y
\`\`\`

## Verification

### Immediate Check
\`\`\`powershell
Get-Command python* | Where-Object {\$_.Version -lt "3.14.0"}
\`\`\`

### Wazuh Rescan
\`\`\`powershell
Restart-Service -Name "Wazuh"
\`\`\`

## Post-Remediation
1. Document which Python version is standard
2. Add Python installation to deployment automation
3. Schedule monthly choco upgrade all
4. Add Wazuh alert for NEW Python installations
`;

export const graph: PlaybookGraph = {
  nodes: [
    { id: 'node_0', label: 'Vulnerability Remediation Playbook: Python CVEs', type: 'phase', metadata: { level: 1, header_type: 'h1' } },
    { id: 'node_1', label: 'Overview', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_2', label: 'Detection (Wazuh)', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_3', label: 'Alert Signature', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_4', label: 'Dashboard Query', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_5', label: 'Execute sql', type: 'execute', metadata: { language: 'sql', code: 'vulnerability.severity: Critical\npackage.name: Python' } },
    { id: 'node_6', label: 'Investigation', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_7', label: 'Step 1: Inventory Python Installations', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_8', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'Get-Command python* -ErrorAction SilentlyContinue | Format-Table -AutoSize' } },
    { id: 'node_9', label: 'Step 2: Identify Vulnerable Versions', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_10', label: 'Version < 3.10.16 then flag as vulnerable?', type: 'decision', metadata: { condition: 'If version < 3.10.16 then flag as vulnerable' } },
    { id: 'node_11', label: 'Version >= 3.14.0 then mark as patched?', type: 'decision', metadata: { condition: 'If version >= 3.14.0 then mark as patched' } },
    { id: 'node_12', label: 'Step 3: Check Active Usage', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_13', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'Get-Process | Where-Object {$_.Path -match "Python310|Python311"}' } },
    { id: 'node_14', label: 'Step 4: Determine Dependencies', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_15', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: '& "C:\\Python310\\python.exe" -m pip list' } },
    { id: 'node_16', label: 'Remediation Options', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_17', label: 'Option A: Uninstall Outdated Versions (Recommended if unused)', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_18', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: '& "$env:LOCALAPPDATA\\Package Cache\\{GUID}\\python-3.10.11-amd64.exe" /uninstall /quiet' } },
    { id: 'node_19', label: 'Option B: Update to Patched Versions', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_20', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'choco upgrade python310 python311 -y' } },
    { id: 'node_21', label: 'Option C: Standardize on One Source', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_22', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'choco install python --version=3.14.2 -y' } },
    { id: 'node_23', label: 'Verification', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_24', label: 'Immediate Check', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_25', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'Get-Command python* | Where-Object {$_.Version -lt "3.14.0"}' } },
    { id: 'node_26', label: 'Wazuh Rescan', type: 'phase', metadata: { level: 3, header_type: 'h3' } },
    { id: 'node_27', label: 'Execute powershell', type: 'execute', metadata: { language: 'powershell', code: 'Restart-Service -Name "Wazuh"' } },
    { id: 'node_28', label: 'Post-Remediation', type: 'phase', metadata: { level: 2, header_type: 'h2' } },
    { id: 'node_29', label: 'Document which Python version is standard', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_30', label: 'Add Python installation to deployment automation', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_31', label: 'Schedule monthly choco upgrade all', type: 'step', metadata: { step_type: 'sequential' } },
    { id: 'node_32', label: 'Add Wazuh alert for NEW Python installations', type: 'step', metadata: { step_type: 'sequential' } },
  ],
  edges: [
    { id: 'edge_0', source: 'node_0', target: 'node_1' },
    { id: 'edge_1', source: 'node_1', target: 'node_2' },
    { id: 'edge_2', source: 'node_2', target: 'node_3' },
    { id: 'edge_3', source: 'node_3', target: 'node_4' },
    { id: 'edge_4', source: 'node_4', target: 'node_5' },
    { id: 'edge_5', source: 'node_5', target: 'node_6' },
    { id: 'edge_6', source: 'node_6', target: 'node_7' },
    { id: 'edge_7', source: 'node_7', target: 'node_8' },
    { id: 'edge_8', source: 'node_8', target: 'node_9' },
    { id: 'edge_9', source: 'node_9', target: 'node_10' },
    { id: 'edge_10', source: 'node_10', target: 'node_11' },
    { id: 'edge_11', source: 'node_11', target: 'node_12' },
    { id: 'edge_12', source: 'node_12', target: 'node_13' },
    { id: 'edge_13', source: 'node_13', target: 'node_14' },
    { id: 'edge_14', source: 'node_14', target: 'node_15' },
    { id: 'edge_15', source: 'node_15', target: 'node_16' },
    { id: 'edge_16', source: 'node_16', target: 'node_17' },
    { id: 'edge_17', source: 'node_17', target: 'node_18' },
    { id: 'edge_18', source: 'node_18', target: 'node_19' },
    { id: 'edge_19', source: 'node_19', target: 'node_20' },
    { id: 'edge_20', source: 'node_20', target: 'node_21' },
    { id: 'edge_21', source: 'node_21', target: 'node_22' },
    { id: 'edge_22', source: 'node_22', target: 'node_23' },
    { id: 'edge_23', source: 'node_23', target: 'node_24' },
    { id: 'edge_24', source: 'node_24', target: 'node_25' },
    { id: 'edge_25', source: 'node_25', target: 'node_26' },
    { id: 'edge_26', source: 'node_26', target: 'node_27' },
    { id: 'edge_27', source: 'node_27', target: 'node_28' },
    { id: 'edge_28', source: 'node_28', target: 'node_29' },
    { id: 'edge_29', source: 'node_29', target: 'node_30' },
    { id: 'edge_30', source: 'node_30', target: 'node_31' },
    { id: 'edge_31', source: 'node_31', target: 'node_32' },
  ],
};

export const libraryItem: PlaybookLibraryItem = {
  slug: 'vulnerability-remediation-python',
  metadata: {
    title: 'Vulnerability Remediation Playbook: Python CVEs',
    type: 'Software Patch Management / Python Environment Hygiene',
    tooling: 'Wazuh (detection) + Chocolatey/Package Manager (remediation)',
    lastUpdated: '2026-02-02',
  },
  category: 'vulnerability-remediation',
  markdown,
  graph,
  description:
    'Remediate Python-related CVEs detected by Wazuh vulnerability scanner. Addresses multiple Python installations and version sprawl.',
  tags: ['python', 'cve', 'wazuh', 'chocolatey', 'patch-management'],
};
